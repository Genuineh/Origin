# Origin 开发路线图

## 项目时间线

**总工期**: 单人全职 5.5 个月（可两人并行压缩到 3.5 个月）

**开始日期**: 2025.11.18

**预计完成日期**: 2026.05.01（单人）/ 2026.03.01（双人）

---

## 开发策略

Origin 采用"引擎层优先"的开发策略：
1. **先完成引擎核心** (Layer 0-6)：提供通用的渲染能力
2. **再实现设计适配器** (Layer 7)：从 OriginFigma 开始，逐步添加其他设计工具支持
3. **最后优化和扩展**：性能优化、跨平台适配、新特性

---

## 阶段 1：基础架构搭建（Week 1-4，约 1 个月）

### Week 1-2：平台和 GPU 抽象层
**目标**: 完成 Layer 0 和 Layer 1

#### 任务清单
- [ ] 初始化 Rust 工作空间
- [ ] 配置 CI/CD 管道
- [ ] 实现 `origin-platform` 模块
  - [ ] 窗口创建和管理（使用 winit）
  - [ ] 事件循环抽象
  - [ ] 平台特定系统调用封装
  - [ ] 文件系统访问接口
- [ ] 实现 `origin-gpu` 模块
  - [ ] wgpu 初始化和上下文管理
  - [ ] Buffer 和 Texture 抽象
  - [ ] Pipeline 创建和管理
  - [ ] Shader 模块系统
  - [ ] 命令编码器封装
- [ ] 编写单元测试和集成测试
- [ ] 创建基础示例程序（显示空窗口）

**交付物**:
- 可运行的窗口应用
- 完整的 GPU 抽象 API
- 测试覆盖率 > 80%

### Week 3-4：SDF 和实例渲染层
**目标**: 完成 Layer 2 和 Layer 3

#### 任务清单
- [ ] 实现 `origin-sdf` 模块
  - [ ] SDF 生成算法
  - [ ] SDF 图集管理
  - [ ] 矢量到 SDF 转换
  - [ ] GPU 加速的距离场计算
  - [ ] 抗锯齿实现
- [ ] 实现 `origin-instance` 模块
  - [ ] 实例数据结构设计
  - [ ] 批处理系统
  - [ ] GPU Instancing 实现
  - [ ] 绘制调用优化
- [ ] 实现基础形状 SDF 渲染
  - [ ] 圆形
  - [ ] 矩形
  - [ ] 三角形
- [ ] 性能基准测试

**交付物**:
- 可渲染基础形状的 demo
- SDF 渲染性能达标（120fps）
- Instance rendering 基准测试

---

## 阶段 2：几何和布局系统（Week 5-8，约 1 个月）

### Week 5-6：几何层
**目标**: 完成 Layer 4

#### 任务清单
- [ ] 实现 `origin-geometry` 模块
  - [ ] 基础形状类型（矩形、圆形、椭圆）
  - [ ] 路径数据结构
  - [ ] 贝塞尔曲线支持
  - [ ] 变换矩阵系统
  - [ ] 包围盒计算
  - [ ] 路径细分（tessellation）
  - [ ] 布尔运算（可选，高级功能）
- [ ] 碰撞检测系统
- [ ] 几何计算优化
- [ ] 复杂路径的 SDF 生成

**交付物**:
- 完整的几何类型系统
- 复杂路径渲染支持
- 性能优化的变换计算

### Week 7-8：布局层
**目标**: 完成 Layer 5

#### 任务清单
- [ ] 实现 `origin-layout` 模块
  - [ ] 基础布局引擎
  - [ ] Auto Layout 算法
  - [ ] Flexbox 布局
  - [ ] 网格布局（可选）
  - [ ] 约束系统
  - [ ] 响应式尺寸计算
  - [ ] 嵌套布局处理
- [ ] 布局缓存和优化
- [ ] 布局调试工具

**交付物**:
- 完整的 Figma Auto Layout 实现
- 布局性能测试
- 示例：复杂嵌套布局

---

## 阶段 3：交互和 Figma 运行时（Week 9-12，约 1 个月）

### Week 9-10：交互层
**目标**: 完成 Layer 6

#### 任务清单
- [ ] 实现 `origin-input` 模块
  - [ ] 输入事件处理
  - [ ] 鼠标/触摸事件
  - [ ] 键盘输入
  - [ ] 手势识别系统
  - [ ] 事件分发和冒泡
  - [ ] 交互状态管理
- [ ] 实现动画系统
  - [ ] 补间动画
  - [ ] 弹簧动画
  - [ ] 关键帧动画
  - [ ] 动画缓动函数
- [ ] 实现过渡效果

**交付物**:
- 完整的交互系统
- 动画演示程序
- 手势识别测试

### Week 11-12：适配器通用接口和 OriginFigma 核心
**目标**: 完成 Layer 7 基础（适配器接口 + OriginFigma 第一阶段）

#### 任务清单
- [ ] 实现 `origin-adapter-common` 模块
  - [ ] `DesignAdapter` trait 定义
  - [ ] `DesignDocument` 通用文档模型
  - [ ] `DesignNode` trait 通用节点抽象
  - [ ] `StyleSystem` 通用样式系统
  - [ ] `ComponentSystem` 通用组件系统
  - [ ] 适配器工具函数库
- [ ] 实现 `origin-figma` 模块（OriginFigma）
  - [ ] `FigmaAdapter` 实现 `DesignAdapter` trait
  - [ ] Figma JSON 解析器
  - [ ] Figma 文档对象模型
  - [ ] 基础节点类型（Frame, Group, Rectangle, etc.）
  - [ ] 样式系统（填充、描边、效果）
  - [ ] 文本渲染（基础）
  - [ ] 图片加载和渲染
- [ ] Figma 到通用文档的转换器
- [ ] 基础组件系统

**交付物**:
- 可解析简单 Figma 文件
- 渲染基础 Figma 设计
- Figma 节点类型支持 > 60%
- 通用适配器接口文档

---

## 阶段 4：高级 Figma 特性（Week 13-16，约 1 个月）

### Week 13-14：OriginFigma 组件和变体系统
**目标**: 完成 OriginFigma 第二阶段

#### 任务清单
- [ ] 组件定义和实例化
- [ ] 组件属性覆盖
- [ ] 变体系统
- [ ] 组件嵌套
- [ ] 组件状态管理
- [ ] 样式库支持

**交付物**:
- 完整的组件系统
- 变体切换演示
- 复杂组件示例

### Week 15-16：OriginFigma 原型和高级效果
**目标**: 完成 OriginFigma 第三阶段

#### 任务清单
- [ ] 原型连接解析
- [ ] 页面导航
- [ ] 交互触发器
- [ ] 过渡动画
- [ ] 高级视觉效果
  - [ ] 模糊
  - [ ] 阴影
  - [ ] 混合模式
  - [ ] 渐变
- [ ] 蒙版和裁剪

**交付物**:
- 原型交互支持
- 高级效果渲染
- 完整 Figma 应用示例

---

## 阶段 5：渲染器优化和应用层（Week 17-20，约 1 个月）

### Week 17-18：渲染器核心优化
**目标**: 完成 `origin-renderer` 优化

#### 任务清单
- [ ] 实现主渲染器
- [ ] 渲染管线优化
- [ ] 帧同步和 vsync
- [ ] 脏区域检测（Dirty Rectangle）
- [ ] 渲染批次优化
- [ ] 内存池化
- [ ] 多线程渲染（可选）
- [ ] GPU 缓冲区优化

**交付物**:
- 稳定 120fps 渲染
- CPU 占用 < 5%（空闲）
- 内存优化

### Week 19-20：应用层和核心工具
**目标**: 完成 `origin-app` 和 `origin-core`

#### 任务清单
- [ ] 实现 `origin-app` 模块
  - [ ] 应用程序框架
  - [ ] 主运行时循环
  - [ ] 资源管理器
  - [ ] 配置系统
  - [ ] 插件系统（可选）
- [ ] 实现 `origin-core` 模块
  - [ ] 数学库封装
  - [ ] 通用数据结构
  - [ ] 错误处理
  - [ ] 日志系统
  - [ ] 性能分析工具
- [ ] 命令行工具
  - [ ] Figma 文件预览
  - [ ] 性能测试
  - [ ] 调试工具

**交付物**:
- 完整的应用程序框架
- CLI 工具
- 开发者工具

---

## 阶段 6：跨平台支持（Week 21-22，约 0.5 个月）

### Week 21-22：平台适配
**目标**: 全平台支持

#### 任务清单
- [ ] Web 平台支持（WASM + WebGPU）
  - [ ] WASM 编译配置
  - [ ] WebGPU 后端
  - [ ] 浏览器集成
- [ ] 移动平台支持
  - [ ] Android 适配
  - [ ] iOS 适配
  - [ ] 触摸输入优化
- [ ] 桌面平台优化
  - [ ] Windows 优化
  - [ ] macOS 优化
  - [ ] Linux 优化
- [ ] 跨平台测试

**交付物**:
- 全平台可运行
- 平台特定优化
- 跨平台测试套件

---

## 阶段 7：测试、文档和发布（Week 23-24，约 0.5 个月）

### Week 23：完整测试和优化
**目标**: 质量保证

#### 任务清单
- [ ] 端到端测试
- [ ] 性能压力测试
- [ ] 内存泄漏检测
- [ ] 边界情况测试
- [ ] 真实 Figma 文件测试
- [ ] 性能瓶颈优化
- [ ] Bug 修复

**交付物**:
- 完整测试报告
- 性能基准
- Bug 列表清零

### Week 24：文档和发布
**目标**: 正式发布

#### 任务清单
- [ ] API 文档生成
- [ ] 用户指南编写
- [ ] 示例项目
- [ ] 教程和视频
- [ ] 性能基准发布
- [ ] 版本 0.1.0 发布
- [ ] GitHub Release 准备
- [ ] 社区支持准备

**交付物**:
- 完整文档
- Origin 0.1.0 发布
- 示例和教程
- 社区支持渠道

---

## 并行开发策略（双人团队）

### 开发者 A：核心渲染
- 负责 Layer 0, 1, 2, 3
- 负责 `origin-renderer` 优化
- 负责性能优化

### 开发者 B：高层抽象
- 负责 Layer 4, 5, 6, 7
- 负责 `origin-figma` 实现
- 负责应用层开发

### 协作点
- Week 4: 集成 SDF + 几何
- Week 8: 集成布局 + 渲染
- Week 12: 集成交互 + Figma
- Week 16: 全栈集成测试

---

## 关键里程碑

| 里程碑 | 时间（单人） | 时间（双人） | 描述 |
|--------|-------------|-------------|------|
| M1: 首次渲染 | Week 2 | Week 1 | 显示第一个 SDF 形状 |
| M2: 复杂图形 | Week 6 | Week 4 | 渲染复杂路径 |
| M3: 布局系统 | Week 8 | Week 5 | Auto Layout 工作 |
| M4: 基础交互 | Week 10 | Week 6 | 点击和动画 |
| M5: Figma 解析 | Week 12 | Week 7 | 解析并渲染 Figma 文件 |
| M6: 组件系统 | Week 14 | Week 9 | 组件和变体 |
| M7: 原型支持 | Week 16 | Week 11 | 完整原型交互 |
| M8: 性能达标 | Week 18 | Week 12 | 120fps 稳定 |
| M9: 全平台 | Week 22 | Week 14 | 所有平台工作 |
| M10: 发布 | Week 24 | Week 15 | Origin 0.1.0 |

---

## 风险和缓解

### 技术风险
1. **SDF 性能不达标**
   - 缓解：GPU 加速 + 图集优化
   - 备选：混合 SDF + 传统光栅化

2. **跨平台一致性问题**
   - 缓解：统一的渲染管线
   - 备选：平台特定优化

3. **Figma 格式变更**
   - 缓解：版本锁定 + 兼容层
   - 备选：多版本支持

### 进度风险
1. **功能蔓延**
   - 缓解：MVP 优先 + 严格范围控制
   
2. **性能优化耗时**
   - 缓解：持续性能测试 + 早期优化

---

## 成功标准

### 功能完整性
- [ ] 支持 90% 常用 Figma 节点类型
- [ ] Auto Layout 完整实现
- [ ] 原型交互支持
- [ ] 组件和变体系统

### 性能指标
- [ ] 稳定 120fps
- [ ] 启动时间 < 100ms
- [ ] 内存占用 < 50MB（基础应用）
- [ ] CPU 占用 < 5%（空闲时）

### 平台支持
- [ ] Web（WASM + WebGPU）
- [ ] Windows
- [ ] macOS
- [ ] Linux
- [ ] Android
- [ ] iOS

### 质量标准
- [ ] 测试覆盖率 > 80%
- [ ] 零 Critical Bug
- [ ] 完整 API 文档
- [ ] 用户指南和教程

---

## 下一步行动

1. ✅ 完成仓库初始化
2. ⏳ 开始阶段 1：Week 1-2 任务
3. ⏳ 搭建 CI/CD
4. ⏳ 实现 Platform Layer

**当前状态**: 仓库已初始化，准备开始开发

**更新日期**: 2025.11.18
